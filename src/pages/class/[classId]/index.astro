---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { agendasConfig, getClassById } from '../../../lib/agendas';
import { classWeekEntries, initAcademicMeta } from '../../../lib/academic';

export function getStaticPaths() {
  return agendasConfig.classes.map((cls) => ({
    params: { classId: cls.id },
  }));
}

const { classId } = Astro.params;
const cls = classId ? getClassById(agendasConfig, classId) : null;
const meta = initAcademicMeta(agendasConfig);

const weeksAsc = cls
  ? classWeekEntries(meta, cls)
      .filter((w) => Boolean(w.slideId))
      .map((w) => w.weekKey)
      .sort((a, b) => a.localeCompare(b))
  : [];
---

<BaseLayout title={cls ? `${cls.name} · Launch Slides` : 'Launch Slides'}>
  <header>
    <div class="topbar">
      <a class="btn-inline" href="/">Home</a>
      <div class="spacer"></div>
      <span class="tag">Redirecting…</span>
    </div>
  </header>

  <main>
    <div class="viewer-container">
      <div id="messageOverlay" role="alert">
        Loading current week…
      </div>
    </div>
  </main>

<div id="redirect-data" data-class-id={classId} data-weeks-asc={JSON.stringify(weeksAsc)}></div>
  <script>
    import '../../../scripts/redirect.js';
  </script>
</BaseLayout>
